<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dlhdlh.mapper.WorkLogMapper">
	<select id="GetWorkLogList" parameterType="com.dlhdlh.dto.WorkLogDto" resultType="com.dlhdlh.dto.WorkLogDto">
		<![CDATA[ 
			SELECT row_number() OVER (ORDER BY ${order1} ${order3}) as row_num, w.idx, w.title, w.content, w.insert_dt, w.insert_user, w.cust_cd, c.cust_nm, DATE_FORMAT(w.receipt_dt, '%Y-%m-%d %h:%m') as receipt_dt, DATE_FORMAT(w.due_dt, '%Y-%m-%d %h:%m') as due_dt, DATE_FORMAT(w.compl_dt, '%Y-%m-%d %h:%m') as compl_dt  
			FROM WorkLog w 
			LEFT OUTER JOIN Customer c 
			ON w.cust_cd = c.cust_cd 
			WHERE w.deleted_yn = "N" AND w.insert_user = #{userId} AND w.compl_yn like concat('%', #{complYn}, '%') AND title like concat('%', #{title}, '%') AND cust_nm like  concat('%', #{custNm}, '%')
			ORDER BY ${order1} ${order2}
		]]>
	</select>
	<!-- 업체 선택을 위한 모탈에 들어가는 데이터-->
	<select id="GetCustList" parameterType="String" resultType="com.dlhdlh.dto.WorkLogDto">
		<![CDATA[ 
			SELECT row_number() OVER (ORDER BY cust_nm) as row_num,cust_cd, cust_nm
			FROM Customer
			WHERE cust_nm like concat('%', #{searchCustNm}, '%') AND deleted_yn ='N'
			ORDER BY cust_nm desc
		]]>
	</select>
	
	<!-- 업무일지 등록 
	<insert id="InsertWorkLog" parameterMap="com.dlhdlh.dto.WorkLogDto">
		<![CDATA[ 
			INSERT INTO WorkLog (title, content, insert_dt, insert_user, cust_cd, receipt_dt, due_dt, compl_dt, compl_yn) 
			VALUES(#{title}, #{content}, now(), #{userId}, #{custCd}, #{receiptDt}, #{dueDt}, #{complDt}, #{complYn}) 
		]]>
	</insert>-->
</mapper >