<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        
        <title>D-world/고객사 관리</title>
        
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

        <link rel="stylesheet" href="/css/basic.css">
        <link rel="stylesheet" href="/css/Customer.css">

        <script>
            $(document).ready(function() {
                $("#btn-editOK").hide();
                $("#btn-insertOK").hide();
                $("#btn-cancel").hide();
                
                //취소 버튼
                $("#btn-cancel").on("click", function(){
                    location.reload();
                });

                // 수정완료 버튼
                $("#btn-editOK").on("click", function() {
                    var valcustCd = $("#input-custCd").val();
                    var valcustNm = $("#input-custNm").val();
                    var valcustBusnum = $("#input-custBusnum").val();
                    var valcustNum = $("#input-custNum").val();
                    var valcustCeonm = $("#input-custCeonm").val();
                    var valcustCeonum = $("#input-custCeonum").val();
                    var valcustAddr = $("#input-custAddr").val();
                    var valcustEmail = $("#input-custEmail").val();
                    var valcustRemark = $("#input-custRemark").val();
                    var datas = {custCd: valcustCd, custNm: valcustNm, custBusnum: valcustBusnum, custNum: valcustNum, custCeonm: valcustCeonm, custCeonum: valcustCeonum
                        , custAddr: valcustAddr, custEmail: valcustEmail, custRemark: valcustRemark};

                    if(!valcustNm){
				        alert("업체명이 비어선 안됩니다.");
			        }else{
                        $.ajax({
                            url: "/dworld/customer/control",
                            type: "put",
                            data: datas,
                            success: function(data) {
                                alert("수정 되었습니다.");
                                location.reload();
                            },
                            error: function() {
                                alert("ajax 통신 오류 발생");
                            }
                        });
                    }
                    
                });

                // 수정 버튼
                $("#btn-edit").on("click", function(){
                    $("#btn-editOK").show();
                    $("#btn-insert").hide();
                    $("#btn-edit").hide();
                    $("#btn-delete").hide();
                    $("#btn-cancel").show();
                    
                    $("#detail-head").text("업체 정보 수정 중");
                
                    document.getElementById("input-custNm").readOnly = false;
                    document.getElementById("input-custBusnum").readOnly = false;
                    document.getElementById("input-custNum").readOnly = false;
                    document.getElementById("input-custCeonm").readOnly = false;
                    document.getElementById("input-custCeonum").readOnly = false;
                    document.getElementById("input-custAddr").readOnly = false;
                    document.getElementById("input-custEmail").readOnly = false;
                    document.getElementById("input-custRemark").readOnly = false;
                });
            
                // $("#btn-editOK").on("click", function(){
                //     var custCd = $("#input-custCd").val();
                //     var custNm = $("#input-custNm").val();
                //     var custBusnum = $("#input-custBusnum").val();
                //     var custNum = $("#input-custNum").val();
                //     var custCeonm = $("#input-custCeonm").val();
                //     var custCeonum = $("#input-custCeonum").val();
                //     var custAddr = $("#input-custAddr").val();
                //     var custEmail = $("#input-custEmail").val();
                //     var custRemark = $("#input-custRemark").val();

                //     if(!custNm){
                //         alert("회사명을 입력해주세요.");
                //     }else{
                //         var frm = $("#input-form")[0];
                //         frm.action = "/customer/update/";
                //         frm.submit();
                //     }
                // });
            
                // $("#btn-delete").on("click", function(){
                //     if(confirm("삭제 하시겠습니까?"))
                //     {
                //         var frm = $("#input-form")[0];
                //         frm.action = "/board/delete";
                //         frm.submit();
                //     }
                // });
                
                // 삭제 버튼
                $("#btn-delete").on("click", function() {
                    if(confirm("삭제 하시겠습니까?")){
                        var valcustCd = $("#input-custCd").val();
                        var datas = {custCd: valcustCd};

                        $.ajax({
                            url: "/dworld/customer/control",
                            type: "delete",
                            data: datas,
                            success: function(data) {
                                alert("삭제 되었습니다.");
                                location.href="/dworld/customer";
                            },
                            error: function() {
                                alert("ajax 통신 오류 발생");
                            }
                        });
                    };
                });

                // 등록 버튼
                $("#btn-insert").on("click", function(){
                    $("#btn-insert").hide();
                    $("#btn-insertOK").show();
                    $("#btn-edit").hide();
                    $("#btn-delete").hide();
                    $("#btn-cancel").show();
                    
                    $("#detail-head").text("업체 정보 등록 중");
                    $("#input-custCd").val("Auto Increment(자동생성)");
                    $("#input-custNm").val("");
                    $("#input-custBusnum").val("");
                    $("#input-custNum").val("");
                    $("#input-custCeonm").val("");
                    $("#input-custCeonum").val("");
                    $("#input-custAddr").val("");
                    $("#input-custEmail").val("");
                    $("#input-custRemark").text("");

                    document.getElementById("input-custNm").readOnly = false;
                    document.getElementById("input-custBusnum").readOnly = false;
                    document.getElementById("input-custNum").readOnly = false;
                    document.getElementById("input-custCeonm").readOnly = false;
                    document.getElementById("input-custCeonum").readOnly = false;
                    document.getElementById("input-custAddr").readOnly = false;
                    document.getElementById("input-custEmail").readOnly = false;
                    document.getElementById("input-custRemark").readOnly = false;

                });

                // 등록 완료 버튼
                $("#btn-insertOK").on("click", function() {
                    var valcustNm = $("#input-custNm").val();
                    var valcustBusnum = $("#input-custBusnum").val();
                    var valcustNum = $("#input-custNum").val();
                    var valcustCeonm = $("#input-custCeonm").val();
                    var valcustCeonum = $("#input-custCeonum").val();
                    var valcustAddr = $("#input-custAddr").val();
                    var valcustEmail = $("#input-custEmail").val();
                    var valcustRemark = $("#input-custRemark").val();
                    var datas = {custNm: valcustNm, custBusnum: valcustBusnum, custNum: valcustNum, custCeonm: valcustCeonm, custCeonum: valcustCeonum
                        , custAddr: valcustAddr, custEmail: valcustEmail, custRemark: valcustRemark};

                    if(!valcustNm){
				        alert("업체명이 비어선 안됩니다.");
			        }else{
                        $.ajax({
                            url: "/dworld/customer/control",
                            type: "post",
                            data: datas,
                            success: function(data) {
                                alert("등록 되었습니다.");
                                location.href="/dworld/customer";
                            },
                            error: function() {
                                alert("ajax 통신 오류 발생");
                            }
                        });
                    }
                });
	        });

            //검색 버튼
            function searchCust(){
                var searchCustNm = document.getElementById('searchCustNm').value;
                window.location.href = "/dworld/customer?SearchCustNm=" + encodeURIComponent(searchCustNm);
            }
        </script>

    </head>
    <body class="pt-1">
        <style type="text/css">
            html, body {height: 100%;}
        </style>

        <div>
            <header th:include="header :: header"></header>
        </div>

        <div class="container pt-2">
            <form id="input-form">
                <!-- 마스터 -->
                <div class="border border-1 border-dark rounded px-3 py-2">
                    <div class="text-center my-2">
                        <h5>업체 관리 마스터 영역</h5>
                    </div>
                    <div class="mb-2 d-flex justify-content-center">
                        <button type="button" class="btn btn-outline-primary me-2 text-nowrap" onclick="searchCust()">검색</button>
                        <input type="text" class="form-control searchcust-inputbox" id="searchCustNm" name="searchCustNm" th:value="${SearchCustNm}" onkeyup="if(window.event.keyCode==13){searchCust()}" placeholder="업체명 Search">
                    </div>

                    <table class="table table-hover table-hover">
                        <colgroup>
                            <col width="5%" />
                            <col width="35%" />
                            <col width="30%" />
                            <col width="30%" />
                        </colgroup>
                        <thead>
                            <tr>
                                <th>Num</th>
                                <th>업체명</th>
                                <th>전화번호</th>
                                <th>대표자명</th>
                            </tr>
                        </thead>
                        <tbody>
                            
                            <tr th:each="list : ${CustList.getList()}" class="text-wrap">
                                <td><a th:text='${list.rowNum}'></a></td>
                                <td><a th:href="@{/dworld/customer(pageNum=${CustList.PageNum}, selectRowNum=${list.rowNum},searchCustNm=${SearchCustNm})}" th:text='${list.custNm}'></a></td>
                                <td><a th:href="@{/dworld/customer(pageNum=${CustList.PageNum}, selectRowNum=${list.rowNum},searchCustNm=${SearchCustNm})}" th:text='${list.custNum}'></a></td>
                                <td><a th:href="@{/dworld/customer(pageNum=${CustList.PageNum}, selectRowNum=${list.rowNum},searchCustNm=${SearchCustNm})}" th:text='${list.custCeonm}'></a></td>
                            </tr>
                            
                            <tr th:unless="${#lists.size(CustList.getList())} > 0">
                                <td colspan="3" class="text-center">내용이 없습니다.</td>
                            </tr>
                        </tbody>
                    </table>
                    <ul class="pagination justify-content-center">
                        <li class="page-item" th:classappend="${CustList.getPrePage() == 0} ? 'disabled'">
                        <a class="page-link" th:href="@{/dworld/customer(pageNum=${CustList.getPrePage()}, searchCustNm=${SearchCustNm})}">Prev</a>
                        </li>
                        <li class="page-item" th:each="page: ${#numbers.sequence(CustList.getNavigateFirstPage(), CustList.getNavigateLastPage())}" th:classappend="${page == CustList.getPageNum()} ? 'active'">
                        <a class="page-link" th:text="${page}" th:href="@{/dworld/customer(pageNum=${page}, searchCustNm=${SearchCustNm})}"></a>
                        
                        </li>
                        <li class="page-item" th:classappend="${CustList.getNextPage() == 0} ? 'disabled'">
                        <a class="page-link"  th:href="@{/dworld/customer(pageNum=${CustList.getNextPage()}, searchCustNm=${SearchCustNm})}">Next</a>
                        </li>
                    </ul>
                </div>

                <!-- 디테일 -->
                <div class="border border-1 border-dark rounded mt-1 px-3 py-2">
                    <div class="text-center">
                        <h5 id="detail-head">업체 관리 디테일 영역</h5>
                    </div>
                    <div class="text-end">
                        <button class="btn btn-outline-success" type="button" id="btn-insert" name="btn-insert">등록</button>
                        <button class="btn btn-outline-success" type="button" id="btn-insertOK" name="btn-insertOK">등록완료</button>
                        <button class="btn btn-outline-secondary" type="button" id="btn-edit" name="btn-edit">수정</button>
                        <button class="btn btn-outline-secondary" type="button" id="btn-editOK" name="btn-editOK">수정완료</button>
                        <button class="btn btn-outline-danger" type="button" id="btn-delete" name="btn-delete">삭제</button>
                        <button class="btn btn-outline-info" type="button" id="btn-cancel" name="btn-cancel">취소</button>
                    </div>
                    
                    <div class="row my-2">
                        <div class="col-12 col-lg form-floating">
                            <input type="text" th:value="${SelectCust.custCd}" class="form-control" disabled id="input-custCd" name="input-custCd">
                            <label for="input-custCd" class="ms-2">업체 코드</label>
                        </div>
                        <div class="col-12 col-lg form-floating">
                            <input type="text" th:value="${SelectCust.custNm}" class="form-control" readonly id="input-custNm" name="input-custNm">
                            <label for="input-custNm" class="ms-2"><b>*업 체 명</b></label>
                        </div>
                    </div>
                    <div class="row my-2">
                        <div class="col-12 col-lg form-floating">
                            <input type="text" th:value="${SelectCust.custBusnum}" class="form-control" readonly id="input-custBusnum" name="input-custBusnum">
                            <label for="input-custBusnum" class="ms-2">사업자 번호</label>
                        </div>
                        <div class="col-12 col-lg form-floating">
                            <input type="text" th:value="${SelectCust.custNum}" class="form-control" readonly id="input-custNum" name="input-custNum">
                            <label for="input-custNum" class="ms-2">전화 번호</label>
                        </div>
                    </div>
                    <div class="row my-2">
                        <div class="col-12 col-lg form-floating">
                            <input type="text" th:value="${SelectCust.custCeonm}" class="form-control" readonly id="input-custCeonm" name="input-custCeonm">
                            <label for="input-custCeonm" class="ms-2">대표명</label>
                        </div>
                        <div class="col-12 col-lg form-floating">
                            <input type="text" th:value="${SelectCust.custCeonum}" class="form-control" readonly id="input-custCeonum" name="input-custCeonum">
                            <label for="input-custCeonum" class="ms-2">대표 번호</label>
                        </div>
                    </div>
                    <div class="row my-2">
                        <div class="form-floating mb-2">
                            <input type="text" th:value="${SelectCust.custAddr}" class="form-control" readonly id="input-custAddr" name="input-custAddr">
                            <label for="input-custAddr" class="ms-2">주 소</label>
                        </div>
                        <div class="form-floating mb-2">
                            <input type="text" th:value="${SelectCust.custEmail}" class="form-control" readonly id="input-custEmail" name="input-custEmail">
                            <label for="input-custEmail" class="ms-2">E-mail</label>
                        </div>
                        <div class="form-floating mb-2">
                            <textarea class="form-control" style="height: 200px;" th:text="${SelectCust.custRemark}" readonly id="input-custRemark" name="input-custRemark"></textarea>
                            <label for="input-custRemark" class="ms-2">비 고</label>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </body>
</html>